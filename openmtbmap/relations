# This style-file is published under CCBYNCSA 3.0 by http://openmtbmap.org . See here for license details: http://creativecommons.org/licenses/by-nc-sa/3.0/
# Please note: 
# a) any works that build upon it, have to give attribution to openmtbmap.org
# b) any maps generated by using the style-file or large parts of it have to give attribution to openmtbmap.org
# c) reusing this style-file or partly reusing it for commercial products/projects is not allowed without special permission by http://openmtbmap.org 




route=road & network=e-road { apply { add int_ref='${ref'; add int_ref='${int_ref'} }

# ascent/descent are usally more important than plain distance
route=mtb & ascent>10000 { apply {add 1ximportance=icn; set extremecarver=mr; add extremecarver4=route; set route_name_mtb1 = '${name}'; add ref = '${ref}' }}
route=mtb & ascent>4500 { apply {add 2ximportance=ncn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb1 = '${name}'; add ref = '${ref}' }}
route=mtb & ascent>1399 { apply {add 3ximportance=rcn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add ref = '${ref}' }}
route=mtb & ascent<1400 & ( descent!=* | descent<2000 )  { apply {add 4ximportnace=lcn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add ref = '${ref}' }}
route=mtb & ascent<1400 { apply {add 3ximportance=rcn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add ref = '${ref}' }}
route=mtb & descent>5000 { apply {add 3xiportance=rcn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add ref = '${ref}' }}
# descent>5000 but few ascent is usually a shuttle assisted freeride tour

route=mtb & distance>300 { apply {add 1ximportance=icn; set extremecarver=mr; add extremecarver4=route; set route_name_mtb1 = '${name}'; add ref = '${ref}' }}
route=mtb & distance>120 { apply {add 2ximportance=ncn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb1 = '${name}'; add ref = '${ref}' }}
route=mtb & distance>51  { apply {add 3ximportance=rcn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add ref = '${ref}' }}
route=mtb & distance<50  { apply {add 4ximportance=lcn; set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add ref = '${ref}' }}


route=mtb	& network=icn				{ apply { set extremecarver=mr; add extremecarver4=route; set route_name_mtb1 = '${name}'; set mtblayer=icn; add ref = '${ref}' } }
route=mountainbike 	& network=icn		{ apply { set extremecarver=mr; add extremecarver4=route; set route_name_mtb1 = '${name}'; set mtblayer=icn; add ref = '${ref}' } }
route=mtb	& network=ncn				{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb1 = '${name}'; set mtblayer=ncn; add ref = '${ref}' } }
route=mountainbike 	& network=ncn		{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb1 = '${name}'; set mtblayer=ncn; add ref = '${ref}' } }
route=mtb	& network=rcn				{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add mtblayer=rcn; add ref = '${ref}' } }
route=mountainbike 	& network=rcn		{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add mtblayer=rcn; add ref = '${ref}' } }
route=mtb	& network=tcn				{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add mtblayer=tcn; add ref = '${ref}' } }
route=mountainbike 	& network=tcn		{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb2 = '${name}'; add mtblayer=tcn; add ref = '${ref}' } }
route=mtb	& network=lcn				{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add mtblayer=lcn; add ref = '${ref}' } }
route=mountainbike 	& network=lcn		{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add mtblayer=lcn; add ref = '${ref}' } }
route=mtb | route=mountainbike			{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add mtblayer=xcn; add ref = '${ref}' } }
route=bicycle & network=mtb 			{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add mtblayer=xcn; add ref = '${ref}' } }
route=bicycle & network=mountainbike	{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add mtblayer=xcn; add ref = '${ref}' } }
route=bicycle & mtb=yes		 			{ apply { set extremecarver=mr; add extremecarver4=route; add route_name_mtb3 = '${name}'; add mtblayer=xcn; add ref = '${ref}' } }




route=bicycle & distance>800 { apply {set 1xnetwork=icn; add extremecarver4=route; set route_name_bike1 = '${name}'; add ref = '${ref}' }}
route=bicycle & distance>300 { apply {set 2xnetwork=ncn; add extremecarver4=route; set route_name_bike1 = '${name}'; add ref = '${ref}' }}
route=bicycle & distance>49  { apply {add 3xnetwork=rcn; add extremecarver4=route; add route_name_bike2 = '${name}'; add ref = '${ref}' }}
route=bicycle & distance<50  { apply {add 4xnetwork=lcn; add extremecarver4=route; add route_name_bike3 = '${name}'; add ref = '${ref}' }}

route=bicycle & ( route=icn | network=icn | icn=yes )		{ apply {  add extremecarver5=bike; add icn=yes; add 1xnetwork=icn; add extremecarver4=route; set route_name_bike1 = '${name}'; add ref = '${ref}' } }
route=bicycle & ( route=ncn | network=ncn | ncn=yes )		{ apply {  add extremecarver5=bike; add ncn=yes; add 2xnetwork=ncn; add extremecarver4=route; set route_name_bike1 = '${name}'; add ref = '${ref}' } } 
route=bicycle & ( route=rcn | network=rcn | rcn=yes )	 	{ apply {  add extremecarver5=bike; add rcn=yes; add 3xnetwork=rcn; add extremecarver4=route; add route_name_bike2 = '${name}'; add ref = '${ref}' } } 
route=bicycle & ( route=tcn | network=tcn | tcn=yes )		{ apply {  add extremecarver5=bike; add rcn=yes; add 3xnetwork=rcn; add extremecarver4=route; add route_name_bike2 = '${name}'; add ref = '${ref}' } }
route=bicycle & ( route=lcn | network=lcn | lcn=yes )		{ apply {  add extremecarver5=bike; add lcn=yes; add 4xnetwork=lcn; add extremecarver4=route; add route_name_bike3 = '${name}'; add ref = '${ref}' } }
route=bicycle & distance!=* & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn & ncn!=yes & icn!=yes & rcn!=yes & lcn!=yes & tcn!=yes	{ apply {  add extremecarver5=bike; add lcn=yes; add extremecarver6=xcn; add extremecarver4=route; add route_name_bike3 = '${name}'; add ref = '${ref}' } }






type=associatedStreet { apply { add addr:street='${name}' } }

# (type=boundary | type=multipolygon) & boundary=administrative & admin_level=1 { apply { set mkgmap:boundary1_name='$(mkgmap:boundary1_name)/${name:en}' | '$(mkgmap:boundary1_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_1=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=administrative & admin_level=2 { apply { set mkgmap:boundary2_name='$(mkgmap:boundary2_name)/${name:en}' | '$(mkgmap:boundary2_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_2=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=administrative & admin_level=3 { apply { set mkgmap:boundary3_name='$(mkgmap:boundary3_name)/${name:en}' | '$(mkgmap:boundary3_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_3=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=administrative & admin_level=4 { apply { set mkgmap:boundary4_name='$(mkgmap:boundary3_name)/${name:en}' | '$(mkgmap:boundary4_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_4=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=administrative & admin_level=5 { apply { set mkgmap:boundary5_name='$(mkgmap:boundary5_name)/${name:en}' | '$(mkgmap:boundary5_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_5=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=administrative & admin_level=6 { apply { set mkgmap:boundary6_name='$(mkgmap:boundary6_name)/${name:en}' | '$(mkgmap:boundary6_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_6=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=administrative & admin_level=8 { apply { set mkgmap:boundary8_name='$(mkgmap:boundary8_name)/${name:en}' | '$(mkgmap:boundary8_name)/${name}' | '${name:en}' | '${name}' | ; set boundary=administrative; set admin_level_8=yes ; set admin_level_copy=yes }}
(type=boundary | type=multipolygon) & boundary=national_park { apply { set mkgmap:boundary99_name='$(mkgmap:boundary99_name)/${name:en}' | '$(mkgmap:boundary99_name)/${name}' | '${name:en}' | '${name}'; set boundary99=yes }}

( route=ferry | line=ferry ) & name=*	{ apply { set name1 = '${name} ${route} ${network} ferry' | '${name} ${route} ferry' | '${route} ${network} ferry' | '${name} ${network} ferry' | '${name} ferry' | '${network} ferry' | '${route} ferry' | 'ferry'; add fromrelation=yes; add route1=ferry } }
( route=ferry | line=ferry ) & name!=* 	{ apply { add fromrelation=yes; add route=ferry } }

route=shuttle_train & name=*	{ apply { set name1 = '${name} s_train' | 'shuttle_train'; add fromrelation=yes; add route1=shuttle_train } }

natural=water { apply { add name='${name}'; set natural=water }}
natural=lake { apply { add name='${name}'; set natural=lake }}

(route=subway|route=train|route=tram) & (ref=* | name=*)
{  add ref='${name}'; 
  # if ref is missing, use name
  # Append the ref of the route relation to the route_ref attribute of
  # the member nodes recursively (even to members of subrelations).
  # Stops can be grouped within subrelations comprising the vehicle
  # stop node and the passenger wait node.
  
  apply { # node role ~ '(start_|end_)stop'
    set route_ref='$(route_ref),${ref}' | '${ref}';

    # In route relations, stops may be defined as relations that group
    # the passenger wait area and the vehicle stop area.  If such
    # subrelations exist, copy the ref to them too.
    set mkgmap:ref='${ref}';

    apply role=passengers {
      set route_ref='$(route_ref),${mkgmap:ref}' | '${mkgmap:ref}';
    }

    delete mkgmap:ref;
  }
  # We could want to copy the route relation name to unnamed route=ferry ways.
  apply { add railwayname='${name}' }
}

type=route
& ( route=road & network!=e-road|route=ski)
{
  add ref='${name}'; # if ref is missing, use name
  set ref='${route} ${network} ${ref}' | '${route} ${ref}' | '${route} ${network}' | '${route}';
  apply { set mkgmap:route='$(mkgmap:route),${ref}' | '${ref}' }
}

route=foot	 & distance>12 & route!=mtb & route!=bicycle & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn	{ apply { add route=hiking; add route_name_hiking = '${name}'; add ref = '${ref}'	} }
route=walking & distance>12 & route!=mtb & route!=bicycle & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn	{ apply { add route=hiking; add route_name_hiking = '${name}'; add ref = '${ref}'	} }
route=foot	 & !( distance>12 ) & route!=mtb & route!=bicycle & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn { apply { add route=foot; add route_name_foot = '${name}'; add ref = '${ref}'	} } 
route=walking & !( distance>12) & route!=mtb & route!=bicycle & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn { apply { add route=foot; add route_name_walking = '${name}'; add ref = '${ref}'	} } 
route=hiking & route!=mtb & route!=bicycle & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn	{ apply { add route=hiking; add route_name_hiking = '${name}'; add ref = '${ref}'	} }


# route=bicycle   & network!=icn & network!=ncn & network!=tcn & network!=rcn & network!=lcn						{ apply { add extremecarver5=bike; set extremecarver6=xcn; add extremecarver4=route; add route_name = '${name}'; add ref = '${ref}' } }
# route=bicycle & ( route=lcn | network=lcn | lcn=yes )	& network!=icn & network!=ncn & network!=tcn & network!=rcn	{ apply { add extremecarver5=bike; set extremecarver6=lcn; add extremecarver4=route; add route_name = '${name}'; add ref = '${ref}' } }
# route=bicycle & ( route=tcn | network=tcn | tcn=yes )	& network!=icn & network!=ncn & network!=rcn				{ apply { add extremecarver5=bike; set extremecarver6=tcn; add extremecarver4=route; add route_name = '${name}'; add ref = '${ref}' } }
route=bicycle & ( route=rcn | network=rcn | rcn=yes )	& network!=icn & network!=ncn								{ apply { add extremecarver5=bike; set extremecarver6=rcn; add extremecarver4=route; add route_name = '${name}'; add ref = '${ref}' } }
route=bicycle & ( route=ncn | network=ncn | ncn=yes )	& network!=icn												{ apply { add extremecarver5=bike; set extremecarver6=ncn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } } 
route=bicycle & ( route=icn | network=icn | icn=yes )																{ apply { add extremecarver5=bike; set extremecarver6=icn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }

route=bicycle & network=mtb 									{ apply { set extremecarver=mr; add mtblayer=xcn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }
route=bicycle & mtb=yes		 									{ apply { set extremecarver=mr; add mtblayer=xcn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }
( route=mtb | route=mountainbike )								{ apply { set extremecarver=mr; add mtblayer=xcn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }
( route=mtb | route=mountainbike )	& network=lcn				{ apply { set extremecarver=mr; add mtblayer=lcn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }
( route=mtb | route=mountainbike )	& network=rcn				{ apply { set extremecarver=mr; add mtblayer=rcn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }
( route=mtb | route=mountainbike )	& network=ncn				{ apply { set extremecarver=mr; set mtblayer=ncn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }
( route=mtb | route=mountainbike )	& network=icn				{ apply { set extremecarver=mr; set mtblayer=icn; add extremecarver4=route; set route_name = '${name}'; add ref = '${ref}' } }

